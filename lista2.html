<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml">
    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width" />

        <title>teste</title>
        <style type="text/css">
            #countinitgame, #countkill, #countkillworld, #countkillgamers, #jogadores, #Zehmatou, #Zehmorreu, #gamer, #gamer2, #jogador1 {
                border: solid;
                border-width: thin;
                height: 30px;
            }
            .classe {
                border: solid;
                border-width: thin;
                width: 800px;
                height: 30px;
                padding: 3px;
                text-align: center;
            }
        </style>
    </head>
    <body>
        
        Por favor selecione o arquivo de log:
        <input type="file" id="idfile" /><br />
        <div><b>Total de partidas: </b></div><div id="countinitgame"></div>
        <br>
        <div><b>Total de mortes: </b></div><div id="countkill"></div>
        <br>
        <div><b>Total de mortes causadas por <code>&lt;world&gt;</code>: </b></div><div id="countkillworld"></div>
        <br>
        <div><b>Total de mortes causadas por outros jogadores: </b></div><div id="countkillgamers"></div>
        <br>
        <div><b>Jogadores participantes: </b></div><div id="jogadores"></div>
        <br>
        <div id="divResultados">
            <table class="classe" id="tableResultados">
                <tr class="classe" id="nomes">
                    <td class="classe" id="vazia">

                    </td>
                    <td class="classe" id="Isgalamido">
                        Isgalamido
                    </td>
                    <td class="classe" id="Dono">
                        Dono
                    </td>
                    <td class="classe" id="Zeh">
                        Zeh
                    </td>
                    <td class="classe" id="Assasinu">
                        Assasinu
                    </td>
                    <td class="classe" id="Oootsimo">
                        Oootsimo
                    </td>
                    <td class="classe" id="Maluquinho">
                        Maluquinho
                    </td>
                    <td class="classe" id="Mal">
                        Mal
                    </td>
                    <td class="classe" id="Chessus">
                        Chessus
                    </td>
                    <td class="classe" id="Mocinha">
                        Mocinha
                    </td>
                    <td class="classe" id="UnnamedPlayer">
                        UnnamedPlayer
                    </td>
                </tr>
                <tr class="classe" id="qtdMorreu">
                    <td class="classe" id="textoQtdMatou">
                        Qtd killed
                    </td>
                    <td class="classe" id="qtdIsgalamidoMatou">
                        
                    </td>
                    <td class="classe" id="qtdDonoMatou">
                        
                    </td>
                    <td class="classe" id="qtdZehMatou">
                        
                    </td>
                    <td class="classe" id="qtdAssasinuMatou">
                        
                    </td>
                    <td class="classe" id="qtdOootsimoMatou">
                        
                    </td>
                    <td class="classe" id="qtdMaluquinhoMatou">
                        
                    </td>
                    <td class="classe" id="qtdMalMatou">
                        
                    </td>
                    <td class="classe" id="qtdChessusMatou">
                        
                    </td>
                    <td class="classe" id="qtdMocinhaMatou">
                        
                    </td>
                    <td class="classe" id="qtdUnnamedPlayerMatou">
                        
                    </td>
                </tr>
                <tr class="classe" id="qtdMatou">
                    <td class="classe" id="textoQtdMorreu">
                        Qtd death
                    </td>
                    <td class="classe" id="qtdIsgalamidoMorreu">
                        
                    </td>
                    <td class="classe" id="qtdDonoMorreu">
                        
                    </td>
                    <td class="classe" id="qtdZehMorreu">
                        
                    </td>
                    <td class="classe" id="qtdAssasinuMorreu">
                        
                    </td>
                    <td class="classe" id="qtdOootsimoMorreu">
                        
                    </td>
                    <td class="classe" id="qtdMaluquinhoMorreu">
                        
                    </td>
                    <td class="classe" id="qtdMalMorreu">
                        
                    </td>
                    <td class="classe" id="qtdChessusMorreu">
                        
                    </td>
                    <td class="classe" id="qtdMocinhaMorreu">
                        
                    </td>
                    <td class="classe" id="qtdUnnamedPlayerMorreu">
                        
                    </td>
                </tr>
            </table>
        </div>
        <br>
        <div></div><div id="gamer"></div>
        <br>
        <div></div><div id="gamer2"></div>
        <br>
        <div></div><div id="jogador1"></div>

        <script>










            document.getElementById('idfile').onchange = function(){

                var file = this.files[0];

                var reader = new FileReader();
                reader.onload = function(progressEvent){
                    // Entire file
                    
                    /////console.log(this.result);

                    // By lines
                    var lines = this.result.split("\n");
                    var countKill = 0;
                    var countInitGame = 0;
                    var countKillworld = 0;
                    var countKillgamers = 0;
                    var arraymortes = [];
                    var arraymortegamer = [];
                    var arrayhmatou = [];
                    var arrayhmorreu = [];
                    var arrayhmorreu = [];
                    var countZehmatou = 0;
                    var countZehmorreu = 0;
                    var countIsgalamidomatou = 0;
                    var countIsgalamidomorreu = 0;
                    var countDonomatou = 0;
                    var countDonomorreu = 0;
                    var countAssasinumatou = 0;
                    var countAssasinumorreu = 0;
                    var countOootsimomatou = 0;
                    var countOootsimomorreu = 0;
                    var countMaluquinhohmatou = 0;
                    var countMaluquinhomorreu = 0;
                    var countMalmatou = 0;
                    var countMalmorreu = 0;
                    var countChessusmatou = 0;
                    var countChessusmorreu = 0;
                    var countMocinhamatou = 0;
                    var countMocinhamorreu = 0;
                    var countUnnamedPlayermatou = 0;
                    var countUnnamedPlayermorreu = 0;
                    var linekill = [];
                    var linekilled = [];
                    var linekilledparcial = [];
                    var linekilledsplit = [];
                    var gamerkilled = [];
                    var linedie = [];
                    var linedied = [];
                    var linediedparcial = [];
                    var linediedsplit = [];
                    var gamerdied = [];
                    var x = 0;
					var partida = 0;
//cria array para calcular pontos
var listamatou = []; //lista deixa repetir
var listamorreu = []; //lista
var pontuacao = new Map(); //mapa guarda dois valores chave e valor
var jogadores = new Set(); //set não deixa repetir cria lista para preencher jogadores unicos

                    for(var line = 0; line < lines.length; line++){
					
var string = lines[line];
var substring = "killed";
var novojogo = "InitGame";

//acha a linha de quando houve mudança no score
var killed = string.indexOf(substring);

if (killed != -1) {
 var matou = string.substring(string.lastIndexOf(":") + 1,killed).trim();
 var morreu = string.substring(killed + 6, string.indexOf("by")).trim();


//Insere quem matou e quem morreu na lista de forma unica
jogadores.add(matou);
jogadores.add(morreu);


//insere no array a pontuação da linha que houve mudança no score
if (matou != morreu){ 
listamatou.push(matou);
listamorreu.push(morreu);
}


}
else if (string.indexOf(novojogo) != -1) {
jogadores.forEach(function contarPontos(jogador) {
var qtdematou = 0;
var qtdemorreu = 0;
for(var i = 0; i < listamatou.length; i++){
if (listamatou[i] == jogador) {
qtdematou++;
}
 }
for(var i = 0; i < listamorreu.length; i++){
if (listamorreu[i] == jogador) {
qtdemorreu++;
}
 }
pontuacao.set(jogador, qtdematou);
 
//console.log(jogadores + " JOGADORES AQUI");
//console.log(JSON.stringify(jogadores) + " STRINGFY AQUI");

 }
 )
console.log(jogadores.values());
console.log(pontuacao); 
console.log(JSON.stringify(Array.from(jogadores.values())));
 partida++; //fecha partida




 
listamatou = [];
listamorreu = [];
jogadores.clear();
pontuacao.clear();
//console.log(listamatou); 
//console.log(listamorreu);
//console.log(jogadores);




}



                        if ((lines[line].includes("InitGame"))){ // Conta quantas partidas teve

                            countInitGame = countInitGame + 1;
                        }
                        else{
                            countInitGame = countInitGame;
                        }

                        if ((lines[line].includes("Kill:"))){ // Conta quantas mortes teve

                            countKill = countKill + 1;

                                                        
                            if ((lines[line].includes("<world> killed "))){ // Conta quantas mortes tiveram pelo <world>

                                countKillworld = countKillworld + 1;

                            }
                            else{
                            
                                countKillgamers = countKillgamers + 1;

                            }
                        }
                            if ((lines[line].includes("Kill:")) && (!lines[line].includes("<world>"))){ // Conta quantas mortes teve

                                


                                arraymortes[line] = (lines[line].trim());

                                arraymatou = arraymortes[line].split(" ");



                                arraymortegamer = arraymortes[line].split("killed");
                                
                                arraymorreu = arraymortegamer[1].split(" ");
                                
                                
                                //console.log("Linhas originais com trim " + lines[line].trim());

                                //console.log("Linha após split por espaços " + arraymatou);

                                //console.log("linha após split por killed " + arraymortegamer);

                                //console.log("linhas após split por killed e depois split por espaços " + arraymorreu);
                                

                                if (arraymatou[5].includes("Isgalamido")){

                                    countIsgalamidomatou = countIsgalamidomatou + 1;
                                    document.getElementById("qtdIsgalamidoMatou").textContent = countIsgalamidomatou;
                                }

                                    else if (arraymorreu[1].includes("Isgalamido")){

                                        countIsgalamidomorreu = countIsgalamidomorreu + 1;
                                        document.getElementById("qtdIsgalamidoMorreu").textContent = countIsgalamidomorreu;

                                    }

                                        else if (arraymatou.includes("Dono")){

                                            countDonomatou = countDonomatou + 1;
                                            document.getElementById("qtdDonoMatou").textContent = countDonomatou;


                                        }

                                            else if (arraymorreu.includes("Dono")){

                                                countDonomorreu = countDonomorreu + 1;
                                                document.getElementById("qtdDonoMorreu").textContent = countDonomorreu;

                                               

                                            }

                                                else if (arraymatou[5].includes("Zeh")){

                                                    countZehmatou = countZehmatou + 1;
                                                    document.getElementById("qtdZehMatou").textContent = countZehmatou;

                                                }

                                                    else if (arraymorreu[1].includes("Zeh")){

                                                        countZehmorreu = countZehmorreu + 1;
                                                        document.getElementById("qtdZehMorreu").textContent = countZehmorreu;

                                                    }

                                                        else if (arraymatou[5].includes("Assasinu")){

                                                            countAssasinumatou = countAssasinumatou + 1;
                                                            document.getElementById("qtdAssasinuMatou").textContent = countAssasinumatou;

                                                        }

                                                            else if (arraymorreu[1].includes("Assasinu")){

                                                                countAssasinumorreu = countAssasinumorreu + 1;
                                                                document.getElementById("qtdAssasinuMorreu").textContent = countAssasinumorreu;

                                                            }

                                                                else if (arraymatou[5].includes("Oootsimo")){

                                                                    countOootsimomatou = countOootsimomatou + 1;
                                                                    document.getElementById("qtdOootsimoMatou").textContent = countOootsimomatou;

                                                                }

                                                                    else if (arraymorreu[1].includes("Oootsimo")){

                                                                        countOootsimomorreu = countOootsimomorreu + 1;
                                                                        document.getElementById("qtdOootsimoMorreu").textContent = countOootsimomorreu;

                                                                    }

                                                                        else if (arraymatou[5].includes("Maluquinho")){

                                                                            countMaluquinhomatou = countMaluquinhomatou + 1;
                                                                            document.getElementById("qtdMaluquinhoMatou").textContent = countMaluquinhomatou;
                                                                            
                                                                        }

                                                                            else if (arraymorreu[1].includes("Maluquinho")){

                                                                                countMaluquinhomorreu = countMaluquinhomorreu + 1;
                                                                                document.getElementById("qtdMaluquinhoMorreu").textContent = countMaluquinhomorreu;

                                                                            }

                                                                                else if (arraymatou[5].includes("Mal")){

                                                                                    countMalmatou = countMalmatou + 1;
                                                                                    document.getElementById("qtdMalMatou").textContent = countMalmatou;

                                                                                }

                                                                                    else if (arraymorreu[1].includes("Mal")){

                                                                                        countMalmorreu = countMalmorreu + 1;
                                                                                        document.getElementById("qtdMalMorreu").textContent = countMalmorreu;

                                                                                    }
                                                                                        else if (arraymatou[5].includes("Chessus")){

                                                                                            countChessusmatou = countChessusmatou + 1;
                                                                                            document.getElementById("qtdChessusMatou").textContent = countChessusmatou;

                                                                                        }
                                                                                            
                                                                                            else if (arraymorreu[1].includes("Chessus")){

                                                                                                countChessusmorreu = countChessusmorreu + 1;
                                                                                                document.getElementById("qtdChessusMorreu").textContent = countChessusmorreu;

                                                                                            }

                                                                                                else if (arraymatou[5].includes("Mocinha")){

                                                                                                    countMocinhamatou = countMocinhamatou + 1;
                                                                                                    document.getElementById("qtdMocinhaMatou").textContent = countMocinhamatou;
                                                                                                   
                                                                                                }

                                                                                                    else if (arraymorreu[1].includes("Mocinha")){

                                                                                                        countMocinhamorreu = countMocinhamorreu + 1;
                                                                                                        document.getElementById("qtdMocinhaMorreu").textContent = countMocinhamorreu;

                                                                                                    }
                                                                                                    
                                                                                                        else if (arraymatou[5].includes("UnnamedPlayer")){

                                                                                                            countUnnamedPlayermatou = countUnnamedPlayermatou + 1;
                                                                                                            document.getElementById("qtdUnnamedPlayerMatou").textContent = countUnnamedPlayermatou;

                                                                                                        }

                                                                                                            else if (arraymorreu[1].includes("UnnamedPlayer")){

                                                                                                                countUnnamedPlayermorreu = countUnnamedPlayermorreu + 1;
                                                                                                                document.getElementById("qtdUnnamedPlayerMorreu").textContent = countUnnamedPlayermorreu;

                                                                                                            }


                                linekill[line] = (lines[line]); //gamerskilled
                                linekilled = linekill[line].split("killed"); //gamerkilled
                                linekilledparcial = linekilled[0]; //gamer
                                linekilledsplit = linekilledparcial.split(":"); //gamer1
                                gamerkilled[line] = linekilledsplit[3]; //gamer2

                                const filteredArraykill = gamerkilled.filter(function(a , b){
                                    return gamerkilled.indexOf(a) == b;
                                }) 


                                linedie[line] = (lines[line]); //gamerskilled
                                linedied = linedie[line].split("killed"); //gamerkilled
                                linediedparcial = linedied[1]; //gamer
                                linediedsplit = linediedparcial.split("by"); //gamer1
                                gamerdied[line] = linediedsplit[0]; //gamer2

                                const filteredArraydie = gamerdied.filter(function(c , d){
                                    return gamerdied.indexOf(c) == d;
                                }) 

                                var teste = [...filteredArraykill, ...filteredArraydie];

                                const filteredArray = teste.filter(function(e , f){
                                    return teste.indexOf(e) == f;
                                }) 

                                document.getElementById("jogadores").textContent = filteredArray;

                            
                            
                            }

                        

                    }
                
                    document.getElementById("countinitgame").textContent = countInitGame; // Total de partidas
                    document.getElementById("countkill").textContent = countKill; // Total de Mortes em todas as partidas
                    document.getElementById("countkillworld").textContent = countKillworld; // Total de mortes causadas por <world>, em todas as partidas
                    document.getElementById("countkillgamers").textContent = countKillgamers; // Total de mortes causadas pelos jogadores, em todas as partidas

                };
                    reader.readAsText(file);
            };
        
        </script>
    </body>
</html>